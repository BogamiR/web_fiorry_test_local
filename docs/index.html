<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>DreamTek Web</title>

    <!-- âœ… Add SDKs BEFORE your module -->
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <script type="module" src="stripeInterop.js"></script>
    <script type="module" src="recaptchaInterop.js"></script>
    <script type="module" src="databaseInterop.js"></script>
    <script type="module" src="cameraInterop.js"></script>
    <script type="module" src="galleryInterop.js"></script>

    <!-- Styles -->
    <link type="text/css" rel="stylesheet" href="styles.css">
    <link type="text/css" rel="stylesheet" href="stylesStripe.css">
    <link type="text/css" rel="stylesheet" href="stylesStripeChoose.css">
    <link type="text/css" rel="stylesheet" href="stylesCaptcha.css">

    <input type="file" id="fileInput" accept="image/*" style="display: none;">

    <!-- Kotlin Wasm JS File from Web Module -->
    <script type="application/javascript" src="webModule.js"></script>
</head>
<body>

<div id="loader-container">
    <div class="loader"></div>
</div>

<div id="compose-container"></div>

<div id="unsupported-banner" style="display: none;">
    <p>Unfortunately, this website requires a newer version of iOS to function properly.</p>
    <p>Please update your operating system.</p>
    <div class="version-info">iOS 18.2 or later is required.</div>
</div>

<div id="payment-screen" class="container">
    <div class="inner-container">
        <div id="card-element" class="card-box"></div>
        <button id="submit-button">Buy subscription</button>
        <div id="payment-status" class="status"></div>
    </div>
</div>

<div id="payment-chooser" class="payment-sheet hidden">
    <div class="payment-sheet-content">
        <button id="pay-with-card" class="pay-button">
            <img src="drawable/ic_stripe_pay_card.svg" alt="Card Icon"> Debit / Credit Card
        </button>

        <div class="or-divider">
            <div class="or-line"></div>
            <span class="or-text">OR</span>
            <div class="or-line"></div>
        </div>

        <div id="apple-pay-button-container" style="display: none;">
            <button id="pay-with-apple" class="pay-button">
                <img src="drawable/ic_stripe_pay_apple.svg" alt="Apple Pay Icon">
            </button>
        </div>

        <div id="google-pay-button-container" style="display: none;">
            <button id="pay-with-google" class="pay-button">
                <img src="drawable/ic_stripe_pay_google.svg" alt="Google Pay Icon">
            </button>
        </div>
    </div>
</div>

<div id="captcha-screen" class="captcha-container">
    <div id="captcha-content" class="captcha-content"></div>
</div>


<script>
    function getIOSVersion() {
        const userAgent = navigator.userAgent;
        const isIOS = /iPhone|iPad|iPod/.test(userAgent) && !window.MSStream;

        console.log("DEBUG: User-Agent:", userAgent);
        console.log("DEBUG: isIOS:", isIOS);

        if (isIOS) {
            const match = userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/);
            if (match && match.length > 2) {
                const version = parseFloat(match[1] + '.' + match[2]);
                return version;
            }
        }
        return 0;
    }

    document.addEventListener('DOMContentLoaded', function() {
        const loaderContainer = document.getElementById('loader-container');
        const unsupportedBanner = document.getElementById('unsupported-banner');

        if (loaderContainer) loaderContainer.style.display = 'flex';
        if (unsupportedBanner) unsupportedBanner.style.display = 'none';

        const isIOS = /iPhone|iPad|iPod/.test(userAgent) && !window.MSStream;
        if (!isIOS) { return; }

        const requiredIOSVersion = 18.2;
        const currentIOSVersion = getIOSVersion();

        console.log(`DEBUG: Checking iOS version: Current=${currentIOSVersion}, Required=${requiredIOSVersion}`);

        if (currentIOSVersion > 0 && currentIOSVersion < requiredIOSVersion) {
            if (loaderContainer) loaderContainer.style.display = 'none';
            if (unsupportedBanner) unsupportedBanner.style.display = 'flex';
            return;
        }
    });
</script>

</body>
</html>
